{"version":3,"file":"FormRequest-legacy.js","sources":["../../../resources/js/core/FormRequest.js"],"sourcesContent":["import Tab from 'bootstrap/js/dist/tab';\n\nexport class FormRequest {\n  constructor(options, formId = '__form__request') {\n    this.options = options;\n    this.formId = formId;\n    this.formEl = $(`#${formId}`);\n    this.cardBody = this.formEl.find('.card-body');\n    this.init();\n  }\n\n  async formSubmit(event) {\n    event.preventDefault();\n    const form = event.target;\n\n    const method = $(form).attr('method');\n    const url = $(form).attr('action');\n    const formData = new FormData(form);\n    await this.sendData(method, url, formData);\n  }\n\n  async sendData(method, url, formData) {\n    this.formEl.find('.validation-error').html('');\n    this.formRequestLoader();\n\n    if (this.__checkOptionMethodsExist() && this.options.methods.beforeSendRequest) {\n      this.options.methods.beforeSendRequest();\n    }\n\n    this.formLoad();\n\n    // eslint-disable-next-line no-undef\n    await axios.post(url, formData)\n      .then(this.successHandler.bind(this))\n      .catch(this.errorHandler.bind(this));\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  successHandler(resp) {\n    resp = resp.data;\n\n    if (this.__checkOptionMethodsExist() && this.options.methods.afterSuccess) {\n      this.formLoad(false);\n      this.formRequestLoader(false);\n      return this.options.methods.afterSuccess(resp);\n    }\n\n    if (resp.redirectUrl) {\n      localStorage.setItem('_message', resp.message);\n      location.href = resp.redirectUrl;\n    } else {\n      this.formRequestLoader(false);\n      this.formLoad(false);\n    }\n  }\n\n  errorHandler(error) {\n    if (error.response && error.response.data.errors) {\n      error = error.response.data;\n\n      this.formEl.find('.validation-error').removeClass('has-error');\n      $('.form-group').removeClass('is-invalid');\n      // eslint-disable-next-line no-restricted-syntax\n      for (const [key, value] of Object.entries(error.errors)) {\n        let hasErrorSpan = this.formEl.find(`.validation-error[data-name=\"${key}\"]`);\n\n        if (!hasErrorSpan.length) {\n          hasErrorSpan = this.formEl.find(`.validation-error[data-name=\"${key}[]\"]`);\n        }\n\n        hasErrorSpan.closest('.form-group').addClass('is-invalid');\n        hasErrorSpan.html(value).addClass('has-error');\n      }\n\n      this.scrollToFirstError();\n\n      if (this.__checkOptionMethodsExist() && this.options.methods.afterError) {\n        this.options.methods.afterError(error);\n      }\n    }\n\n    this.formRequestLoader(false);\n    this.formLoad(false);\n  }\n\n  scrollToFirstError() {\n    const firstError = this.formEl.find('.validation-error.has-error').first();\n\n    const tabPane = firstError.closest('.tab-pane');\n    if (tabPane.length) {\n      const tabId = tabPane.attr('id');\n      const tabTrigger = document.querySelector(`a[data-bs-toggle=\"tab\"][href=\"#${tabId}\"]`);\n      if (tabTrigger) {\n        const tab = new Tab(tabTrigger);\n        tab.show();\n      }\n    }\n\n    if (firstError.length) {\n      setTimeout(() => {\n        $('html, body').animate({\n          scrollTop: firstError.offset().top - 300,\n        }, 200);\n      }, 150);\n    }\n  }\n\n  formRequestLoader(is = true) {\n    const spinner = this.formEl.find('button.form__request__send__btn .spinner-border');\n    const btn = this.formEl.find('button.form__request__send__btn');\n    if (is) {\n      spinner.css({ display: 'inline-block' });\n      btn.prop('disabled', true);\n    } else {\n      spinner.hide();\n      btn.prop('disabled', false);\n    }\n  }\n\n  formLoad(is = true) {\n    if (is) {\n      this.cardBody.addClass('loading-content');\n    } else {\n      this.cardBody.removeClass('loading-content');\n    }\n  }\n\n  showMode() {\n    this.formEl.find(':input').prop('disabled', true);\n  }\n\n  clickSubmit() {\n    this.formEl.submit(this.formSubmit.bind(this));\n  }\n\n  init() {\n    if (this.formEl.hasClass('show-mode')) {\n      this.showMode();\n    }\n\n    this.clickSubmit();\n    this.formRequestLoader(false);\n    this.formLoad(false);\n  }\n\n  __checkOptionMethodsExist() {\n    return typeof this.options != 'undefined' && typeof this.options.methods != 'undefined';\n  }\n}\n"],"names":["exports","constructor","options","formId","this","formEl","$","cardBody","find","init","formSubmit","event","preventDefault","form","target","method","attr","url","formData","FormData","sendData","html","formRequestLoader","__checkOptionMethodsExist","methods","beforeSendRequest","formLoad","axios","post","then","successHandler","bind","catch","errorHandler","resp","data","afterSuccess","redirectUrl","localStorage","setItem","message","location","href","error","response","errors","removeClass","key","value","Object","entries","hasErrorSpan","length","closest","addClass","scrollToFirstError","afterError","firstError","first","tabPane","tabId","tabTrigger","document","querySelector","Tab","show","setTimeout","animate","scrollTop","offset","top","is","spinner","btn","css","display","prop","hide","showMode","clickSubmit","submit","hasClass"],"mappings":"qHAoJAA,EAAA,IAlJO,MACLC,WAAAA,CAAYC,EAASC,EAAS,mBAC5BC,KAAKF,QAAUA,EACfE,KAAKD,OAASA,EACdC,KAAKC,OAASC,EAAE,IAAIH,KACpBC,KAAKG,SAAWH,KAAKC,OAAOG,KAAK,cACjCJ,KAAKK,MACT,CAEE,gBAAMC,CAAWC,GACfA,EAAMC,iBACN,MAAMC,EAAOF,EAAMG,OAEbC,EAAST,EAAEO,GAAMG,KAAK,UACtBC,EAAMX,EAAEO,GAAMG,KAAK,UACnBE,EAAW,IAAIC,SAASN,SACpBT,KAACgB,SAASL,EAAQE,EAAKC,EACrC,CAEE,cAAME,CAASL,EAAQE,EAAKC,GAC1Bd,KAAKC,OAAOG,KAAK,qBAAqBa,KAAK,IAC3CjB,KAAKkB,oBAEDlB,KAAKmB,6BAA+BnB,KAAKF,QAAQsB,QAAQC,mBAC3DrB,KAAKF,QAAQsB,QAAQC,oBAGvBrB,KAAKsB,iBAGCC,MAAMC,KAAKX,EAAKC,GACnBW,KAAKzB,KAAK0B,eAAeC,KAAK3B,OAC9B4B,MAAM5B,KAAK6B,aAAaF,KAAK3B,MACpC,CAGE0B,cAAAA,CAAeI,GAGb,GAFAA,EAAOA,EAAKC,KAER/B,KAAKmB,6BAA+BnB,KAAKF,QAAQsB,QAAQY,aAG3D,OAFAhC,KAAKsB,UAAS,GACdtB,KAAKkB,mBAAkB,QACXpB,QAAQsB,QAAQY,aAAaF,GAGvCA,EAAKG,aACPC,aAAaC,QAAQ,WAAYL,EAAKM,SACtCC,SAASC,KAAOR,EAAKG,cAErBjC,KAAKkB,mBAAkB,GACvBlB,KAAKsB,UAAS,GAEpB,CAEEO,YAAAA,CAAaU,GACX,GAAIA,EAAMC,UAAYD,EAAMC,SAAST,KAAKU,OAAQ,CAChDF,EAAQA,EAAMC,SAAST,KAEvB/B,KAAKC,OAAOG,KAAK,qBAAqBsC,YAAY,aAClDxC,EAAE,eAAewC,YAAY,cAE7B,IAAK,MAAOC,EAAKC,KAAUC,OAAOC,QAAQP,EAAME,QAAS,CACvD,IAAIM,EAAe/C,KAAKC,OAAOG,KAAK,gCAAgCuC,OAE/DI,EAAaC,SAChBD,EAAe/C,KAAKC,OAAOG,KAAK,gCAAgCuC,UAGlEI,EAAaE,QAAQ,eAAeC,SAAS,cAC7CH,EAAa9B,KAAK2B,GAAOM,SAAS,YAC1C,CAEMlD,KAAKmD,qBAEDnD,KAAKmB,6BAA+BnB,KAAKF,QAAQsB,QAAQgC,YAC3DpD,KAAKF,QAAQsB,QAAQgC,WAAWb,EAExC,CAEIvC,KAAKkB,mBAAkB,GACvBlB,KAAKsB,UAAS,EAClB,CAEE6B,kBAAAA,GACE,MAAME,EAAarD,KAAKC,OAAOG,KAAK,+BAA+BkD,QAE7DC,EAAUF,EAAWJ,QAAQ,aACnC,GAAIM,EAAQP,OAAQ,CAClB,MAAMQ,EAAQD,EAAQ3C,KAAK,MACrB6C,EAAaC,SAASC,cAAc,kCAAkCH,OACxEC,GACU,IAAIG,EAAIH,GAChBI,MAEZ,CAEQR,EAAWL,QACbc,YAAW,KACT5D,EAAE,cAAc6D,QAAQ,CACtBC,UAAWX,EAAWY,SAASC,IAAM,KACpC,IAAI,GACN,IAET,CAEEhD,iBAAAA,CAAkBiD,GAAK,GACrB,MAAMC,EAAUpE,KAAKC,OAAOG,KAAK,mDAC3BiE,EAAMrE,KAAKC,OAAOG,KAAK,mCACzB+D,GACFC,EAAQE,IAAI,CAAEC,QAAS,iBACvBF,EAAIG,KAAK,YAAY,KAErBJ,EAAQK,OACRJ,EAAIG,KAAK,YAAY,GAE3B,CAEElD,QAAAA,CAAS6C,GAAK,GACRA,EACFnE,KAAKG,SAAS+C,SAAS,mBAEvBlD,KAAKG,SAASuC,YAAY,kBAEhC,CAEEgC,QAAAA,GACE1E,KAAKC,OAAOG,KAAK,UAAUoE,KAAK,YAAY,EAChD,CAEEG,WAAAA,GACE3E,KAAKC,OAAO2E,OAAO5E,KAAKM,WAAWqB,KAAK3B,MAC5C,CAEEK,IAAAA,GACML,KAAKC,OAAO4E,SAAS,cACvB7E,KAAK0E,WAGP1E,KAAK2E,cACL3E,KAAKkB,mBAAkB,GACvBlB,KAAKsB,UAAS,EAClB,CAEEH,yBAAAA,GACE,YAA8B,SAAXrB,cAAyD,IAApBE,KAACF,QAAQsB,OACrE"}